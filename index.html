<!-- 

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!-- 
    This code was written by a person with very little Web/JS knowledge, don't judge. 
    https://github.com/quarck/MathGen6th/issues for reporting any issues 
-->

<html>
    <head>
        <title>Math's 6 class</title>
        <link rel="stylesheet" type="text/css" href="main.css">
    </head>
    <body>

        <div id="contentRoot" style='display:none;'>
            
            <div class="row">
                <div class="column" id="problems_left"></div>
                <div class="column" id="problems_right"></div>
            </div>

            <div style="display:block;width:100%;"><h2>&nbsp;</h2></div>
            
            <div style="break-after:page;width:100%;display:block;"></div>

            <div class='title'>
                <table><tr><td><h2>Answers:</h2></td></tr></table>
            </div>

            <div class="row">
                <div class="column" id="answers_left"></div>
                <div class="column" id="answers_right"></div>
            </div>
        </div>

        <div id="inputForm">
            <h3>Math problems generator for 6th class of Junior school</h3>
            <input type="hidden" id="debugd" checked="true"></input>
            <table>
                <tr>
                    <td class="form"><b>Number of problems:</b></td>
                    <td class="form"><input type="number" id="num_problems" value="60"/></td>
                </tr>
                <tr>
                    <td class="form"><b>Difficulty level (1-10):</b></td>
                    <td class="form"><input type="number" id="difficulty" value="5"/><br>(Beta! This param is currently mostly ignored)</td>
                </tr>
                <tr>
                    <td class="form"></td>
                    <td class="form"><input type="button" id="generate" onclick="generate()" value="Generate!"/></td>
                </tr>
                
                <tr>
                    <td class="form"></td>
                    <td class="form">
                    Generated problem set is (relatively) printer friendly. <br>
                    When you need a new problem set - just refresh the page to see this form again.</td>
                </tr>
                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top"><b>License information:</b></td>
                    <td class="form">
                        <p><b>Use this generator at your own risk, no warranty given</b></p>
                        <p>Feel free to use this generator for yourself and recommend to others if you find it is useful!</p>

                        <p><i>Generated math problems</i> are in a <a href="https://wiki.creativecommons.org/wiki/public_domain">Public domain</a></p>
                        <p><i>Source code of the generator</i> is licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GPLv3 license</a> </p>
                    </td>
                </tr>
                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top"><b>Feedback &amp; Issues report:</b></td>
                    <td class="form">
                        <p><a href="https://github.com/quarck/MathGen6th/issues">github.com/quarck/MathGen6th/issues</a></p>   
                    </td>
                </tr>

                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top">Created by:</td>
                    <td class="form">
                        Sergey Parshin
                    </td>
                </tr>
            </table>        
        </div>

        <script language="JavaScript" src="cdf.js"></script>
        <script language="JavaScript" src="fractions.js"></script>
        <script language="JavaScript" src="util.js"></script>
        <script language="JavaScript" src="geometry.js"></script>
        <script language="JavaScript" src="data.js"></script>
        <script language="JavaScript" src="problems.js"></script>

        <script language="JavaScript">            
            function newChild(parent, type, attr)
            {
                let newElement = document.createElement(type)
                parent.appendChild(newElement)
                if (attr) 
                {
                    for (let name of Object.keys(attr))
                    {
                        if (name == 'innerHTML')
                        {
                            newElement.innerHTML = attr[name]
                        }
                        else
                        {
                            newElement.setAttribute(name, attr[name])
                        }
                    }
                }
                return newElement
            }

            function generateEntry(n, isProblemEntry)
            {
                let suffix = (n % 2) == 1 ? "_left" : "_right"
                let prefix = isProblemEntry ? "problems" : "answers"

                let root = document.getElementById(prefix + suffix) 

                let div = newChild(root, 'div', {class: 'element'})
                let table = newChild(div, 'table')
                
                let tr = newChild(table, "tr", {valign: 'top'})
                table.appendChild(tr)

                let numMark = isProblemEntry ? ("<b>" + n + ")</b><p/>&nbsp;") : ("<b>" + n + ")</b>")
                let tdClass = (isProblemEntry ? 'problem' : 'answer')

                let td1 = newChild(tr, "td", {innerHTML: numMark})
                let td2 = newChild(tr, "td", {class: tdClass})

                return td2
            }                    
            
            function generate()
            {
                let num_problems = parseInt(document.getElementById('num_problems').value)
                let difficulty = parseInt(document.getElementById('difficulty').value)
                let debug = document.getElementById('debug')

                // hide the form
                document.getElementById('inputForm').setAttribute('style', 'display:none;')

                // unhide the content
                document.getElementById('contentRoot').setAttribute('style', 'display:block;')

                if (!debug)
                {
                    let nextProbGenerator = createProbGenerator()

                    for (let idx = 0; idx < num_problems; ++ idx)
                    {
                        let even = idx % 2 == 0
                        nextProbGenerator().fun(
                            generateEntry(idx + 1, true), 
                            generateEntry(idx + 1, false), 
                            difficulty 
                            )
                    }
                }
                else
                {
                    // in debug we iterate over all possible combinations 
                    let generators = getGeneratorsRaw()
                    let bigidx = 1
                    let difficulty_l = 1
                    let difficulty_r = 10
                    for (let cat of generators)
                    {
                        console.log("CAT: ", cat.name)
                        for (let idx = 0; idx < cat.data.length; ++ idx)
                        {
                            console.log("\tPROB: ", cat.data[idx].name)

                            let probEntry1 = generateEntry(bigidx, true)
                            let ansEntry1 = generateEntry(bigidx, false)
                            cat.data[idx].fun(probEntry1, ansEntry1, difficulty_l)
                            probEntry1.innerHTML += '<br><small style="color:#777">' + cat.data[idx].name + ' at difficulty ' + difficulty_l + ', ANS:</small><br>' + ansEntry1.innerHTML 
                            bigidx ++

                            let probEntry2 = generateEntry(bigidx, true)
                            let ansEntry2 = generateEntry(bigidx, false)
                            cat.data[idx].fun(probEntry2, ansEntry2, difficulty_r)
                            probEntry2.innerHTML += '<br><small style="color:#777">' + cat.data[idx].name + ' at difficulty ' + difficulty_r + ', ANS:</small><br>' + ansEntry2.innerHTML
                            bigidx ++
                        }
                    }

                }
            }

            if (document.getElementById('debug'))
                generate()
        </script>
    </body>
</html>
