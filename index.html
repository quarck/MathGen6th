<!-- 

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.

-->
<!-- 
    This code was written by a person with very little Web/JS knowledge, don't judge. 
    https://github.com/quarck/MathGen6th/issues for reporting any issues 
-->

<html>
    <head>
        <title>Math's 6 class</title>
        <link rel="stylesheet" type="text/css" href="main.css">
    </head>
    <body>

        <div id="contentRoot"></div>

        <div id="inputForm">
            <h3>Math problems generator for 6th class of Junior school</h3>
            <input type="hidden" id="debug1" checked="true"></input>
            <table>
                <tr>
                    <td class="form"><b>Number of problems:</b></td>
                    <td class="form"><input type="number" id="num_problems" value="60"/></td>
                </tr>
                <tr>
                    <td class="form"></td>
                    <td class="form"><input type="button" id="generate" onclick="generate()" value="Generate!"/></td>
                </tr>
                
                <tr>
                    <td class="form"></td>
                    <td class="form">
                    Generated problem set is (relatively) printer friendly. <br>
                    When you need a new problem set - just refresh the page to see this form again.</td>
                </tr>
                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top"><b>License information:</b></td>
                    <td class="form">
                        <p><b>Use this generator at your own risk, not warranty given</b></p>
                        <p>Feel free to use this generator for yourself and recommend to others if you find it is useful!</p>

                        <p><i>Generated math problems</i> are in a <a href="https://wiki.creativecommons.org/wiki/public_domain">Public domain</a></p>
                        <p><i>Source code of the generator</i> is licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GNU GPLv3 license</a> </p>
                    </td>
                </tr>
                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top"><b>Feedback &amp; Issues report:</b></td>
                    <td class="form">
                        <p><a href="https://github.com/quarck/MathGen6th/issues">github.com/quarck/MathGen6th/issues</a></p>   
                    </td>
                </tr>

                <tr><td class="form"></td><td class="form"></td></tr>
                <tr>
                    <td class="form" valign="top">Created by:</td>
                    <td class="form">
                        Sergey Parshin
                    </td>
                </tr>
            </table>        
        </div>

        <script language="JavaScript" src="cdf.js"></script>
        <script language="JavaScript" src="util.js"></script>
        <script language="JavaScript" src="geometry.js"></script>
        <script language="JavaScript" src="data.js"></script>
        <script language="JavaScript" src="problems.js"></script>

        <script language="JavaScript">                    
            function hideForm()
            {
                let form = document.getElementById('inputForm')
                while (form.hasChildNodes())
                {
                    form.removeChild(form.childNodes[0])
                }
            }

            function newChild(parent, type, attr)
            {
                let newElement = document.createElement(type)
                parent.appendChild(newElement)
                if (attr) 
                {
                    for (let name of Object.keys(attr))
                    {
                        if (name == 'innerHTML')
                        {
                            newElement.innerHTML = attr[name]
                        }
                        else
                        {
                            newElement.setAttribute(name, attr[name])
                        }
                    }
                }
                return newElement
            }

            function generateMainLayout()
            {
                let root = document.getElementById("contentRoot")

                // main table with the problems 
                let problems = newChild(root, "table", {width: "100%"})
                let tr = newChild(problems, "tr", {valign: 'top'})
                let leftTd = newChild(tr, "td", {width: "50%"})
                let rightTd = newChild(tr, "td", {width: "50%"})
                let leftSubTable = newChild(leftTd, "table")
                let rightSubTable = newChild(rightTd, "table")

                let pageBreak = newChild(root, "div", {style: "break-after:page"})

                let answersLabel = newChild(root, 'div', {innerHTML: '<h2>Answers<h2>'})

                let answers = newChild(root, "table",  {width: "100%"})
                let ansTr = newChild(answers, "tr", {valign: 'top'})
                let ansLeftTd = newChild(ansTr, "td", {width: "50%"})
                let ansRightTd = newChild(ansTr, "td", {width: "50%"})
                let ansLeftSubTable = newChild(ansLeftTd, "table")
                let ansRightSubTable = newChild(ansRightTd, "table")

                return {
                    problems: {
                        left: leftSubTable, 
                        right: rightSubTable 
                    }, 
                    answers: {
                        left: ansLeftSubTable, 
                        right: ansRightSubTable 
                    },
                }
            }

            function generateEntry(table, n, isProblemEntry)
            {
                let tr = newChild(table, "tr", {valign: 'top'})
                table.appendChild(tr)

                let numMark = isProblemEntry ? ("<b>" + n + ")</b><p/>&nbsp;") : ("<b>" + n + ")</b>")
                let tdClass = (isProblemEntry ? 'problem' : 'answer')

                let td1 = newChild(tr, "td", {innerHTML: numMark})
                let td2 = newChild(tr, "td", {class: tdClass})

                return td2
            }                    
            
            function generate()
            {
                let num_problems = parseInt(document.getElementById('num_problems').value)
                let debug = document.getElementById('debug')

                hideForm()

                let cont = generateMainLayout()

                

                if (!debug)
                {
                    let nextProbGenerator = createProbGenerator()

                    for (let idx = 0; idx < num_problems; ++ idx)
                    {
                        let even = idx % 2 == 0

                        let problemsRow = generateEntry(even ? cont.problems.left : cont.problems.right, idx + 1, true)
                        let answersRow = generateEntry(even ? cont.answers.left : cont.answers.right, idx + 1, false)

                        nextProbGenerator().fun(problemsRow, answersRow)                        
                    }
                }
                else
                {
                    // in debug we iterate over all possible combinations 
                    let generators = getGeneratorsRaw()
                    let bigidx = 1
                    for (let cat of generators)
                    {
                        for (let idx = 0; idx < cat.data.length; ++ idx)
                        {
                            let nameRowLeft = generateEntry(cont.problems.left, bigidx, false)
                            let nameRowRight = generateEntry(cont.problems.right, bigidx+1, false)
                            nameRowLeft.innerHTML = '<b>L ' + cat.data[idx].name + '</b>'
                            nameRowRight.innerHTML = '<b>R ' + cat.data[idx].name + '</b>'

                            let problemsRowLeft = generateEntry(cont.problems.left, bigidx, true)
                            let answersRowLeft = generateEntry(cont.answers.left, bigidx, false)
                            let problemsRowRight = generateEntry(cont.problems.right, bigidx+1, true)
                            let answersRowRight = generateEntry(cont.answers.right, bigidx+1, false)
                            
                            cat.data[idx].fun(problemsRowLeft, answersRowLeft)
                            cat.data[idx].fun(problemsRowRight, answersRowRight)

                            bigidx += 2
                        }
                    }

                }
            }

            if (document.getElementById('debug'))
                generate()
        </script>
    </body>
</html>